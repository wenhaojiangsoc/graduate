strip.text.x = element_text(size = 14, colour = "black", face="bold"),
panel.border = element_rect(colour = "black", fill = NA, linewidth=0.6),
axis.text.y = element_text(size=10, angle=90, hjust=0.5),
axis.text.x = element_text(size=10),
axis.title.x = element_blank(),
axis.title=element_text(size=14,hjust=0.5),
legend.text = element_text(size=14),
legend.title = element_text(size=14)) +
guides(colour = guide_legend(override.aes = list(linewidth = 0.8, size = 2)))
results_pooled <- data.frame()
for (year in c(1980,1990,2000,2010,2019)) {
dsub <- df[df$year == year, ]
model <- glm(
is_PM_egp ~ factor(edu_attain_3cat) + factor(lmexp) +
factor(race) + factor(public) + factor(ind1990_agg),
data = dsub,
weights = weight,
family = binomial(link = "logit")
)
# predicted probabilities
p_hat <- predict(model, type = "response")
result <- dsub %>%
mutate(p_hat = predict(model, type = "response")) %>%
group_by(edu_attain_3cat) %>%
dplyr::summarize(
prob = weighted.mean(p_hat, weight),
SE   = sd(p_hat, na.rm = TRUE) / sqrt(n()),   # <-- simple unweighted SE of preds
.groups = "drop"
) %>%
mutate(year = year,
category = "pooled")
results_pooled <- rbind(results_pooled, result)
}
## rescale weight so that weight sums to mean in each year
## this is to ensure reasonable model convergence
df <- df %>%
group_by(year) %>%
mutate(weight = weight/mean(weight))
results_pooled <- data.frame()
## run multinomial every year
results_detailed <- data.frame()
library(nnet)
df_multi <- df %>% mutate(P_M_egp = case_when(
occ2010 >= 10 & occ2010 <= 430 & is_PM_egp == 1 ~ 1, ## management
(occ2010 > 430 & is_PM_egp == 1) ~ 2,      ## professional
.default = 0                                  ## non-PM
))
unique(df$is_PM_egp)
df_multi <- df %>% mutate(P_M_egp = case_when(
occ2010 >= 10 & occ2010 <= 430 & is_PM_egp == 1 ~ 1, ## management
(occ2010 > 430 & is_PM_egp == 1) ~ 2,      ## professional
.default = 0                                  ## non-PM
))
for (year in c(1980,1990,2000,2010,2019)) {
## subset once for this year
dsub <- df_multi[df_multi$year==year,]
## specify model and predict (use weights=)
model <- multinom(
P_M_egp ~ factor(edu_attain_3cat) + factor(lmexp) + factor(race) +
factor(public) + factor(ind1990_agg),
data = dsub,
weights = weight
)
## get predicted probs for the same rows in dsub
preds <- predict(model, newdata = dsub, type = "probs")
## summarize (columns will be named "0","1","2" if your factor is coded that way)
result <- dsub %>%
bind_cols(as.data.frame(preds)) %>%
group_by(edu_attain_3cat) %>%
summarize(
prob_P = weighted.mean(`2`, weight),
prob_M = weighted.mean(`1`, weight),
prob_O = weighted.mean(`0`, weight),
.groups = "drop"
) %>%
mutate(year=year)
results_detailed <- rbind(results_detailed, result)
}
results_detailed %>%
remove_labels() %>%
mutate(prob_PM = prob_P + prob_M) %>%
mutate(
edu_attain_3cat = factor(
edu_attain_3cat,
levels = c(0, 1, 2),
labels = c("less than BA/BS", "BA/BS", "graduate")
)
) %>%
pivot_longer(
cols = starts_with("prob_"),     # prob_P, prob_M, prob_O
names_to = "category",
values_to = "prob"
) %>%
filter(category!="prob_O") %>%
mutate(category = factor(category,
levels = c("prob_PM", "prob_P", "prob_M"))) %>%
ggplot(aes(x = year, y = prob)) +
geom_line(aes(color = edu_attain_3cat)) +
geom_point(aes(color = edu_attain_3cat)) +
geom_text_repel(
aes(label = sprintf("%.3f", prob), color = edu_attain_3cat),
size = 3,
show.legend = FALSE,
max.overlaps = Inf
) +
theme_bw() +
facet_grid(~category, labeller = labeller(category = c("prob_PM" = "PM combined",
"prob_P" = "professional",
"prob_M" = "managerial"))) +
scale_color_manual(
name = "",
labels = c("less than BA/BS", "BA/BS", "graduate"),
values = c("less than BA/BS" = "blue",
"BA/BS"  = "green3",
"graduate" = "red")
) +
theme(text = element_text(family="Times"),
legend.position="bottom",
plot.title = element_text(size=11),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_blank(),
strip.text.x = element_text(size = 14, colour = "black", face="bold"),
panel.border = element_rect(colour = "black", fill = NA, linewidth=0.6),
axis.text.y = element_text(size=10, angle=90, hjust=0.5),
axis.text.x = element_text(size=10),
axis.title.x = element_blank(),
axis.title=element_text(size=14,hjust=0.5),
legend.text = element_text(size=14),
legend.title = element_text(size=14)) +
guides(colour = guide_legend(override.aes = list(linewidth = 0.8, size = 2))) +
labs(
color = "",
x = "",
y = "Predicted Probability"
) +
ylim(0,0.9) +
xlim(1979,2021)
)
## plot the results
library(ggrepel)
results_detailed %>%
remove_labels() %>%
mutate(prob_PM = prob_P + prob_M) %>%
mutate(
edu_attain_3cat = factor(
edu_attain_3cat,
levels = c(0, 1, 2),
labels = c("less than BA/BS", "BA/BS", "graduate")
)
) %>%
pivot_longer(
cols = starts_with("prob_"),     # prob_P, prob_M, prob_O
names_to = "category",
values_to = "prob"
) %>%
filter(category!="prob_O") %>%
mutate(category = factor(category,
levels = c("prob_PM", "prob_P", "prob_M"))) %>%
ggplot(aes(x = year, y = prob)) +
geom_line(aes(color = edu_attain_3cat)) +
geom_point(aes(color = edu_attain_3cat)) +
geom_text_repel(
aes(label = sprintf("%.3f", prob), color = edu_attain_3cat),
size = 3,
show.legend = FALSE,
max.overlaps = Inf
) +
theme_bw() +
facet_grid(~category, labeller = labeller(category = c("prob_PM" = "PM combined",
"prob_P" = "professional",
"prob_M" = "managerial"))) +
scale_color_manual(
name = "",
labels = c("less than BA/BS", "BA/BS", "graduate"),
values = c("less than BA/BS" = "blue",
"BA/BS"  = "green3",
"graduate" = "red")
) +
theme(text = element_text(family="Times"),
legend.position="bottom",
plot.title = element_text(size=11),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_blank(),
strip.text.x = element_text(size = 14, colour = "black", face="bold"),
panel.border = element_rect(colour = "black", fill = NA, linewidth=0.6),
axis.text.y = element_text(size=10, angle=90, hjust=0.5),
axis.text.x = element_text(size=10),
axis.title.x = element_blank(),
axis.title=element_text(size=14,hjust=0.5),
legend.text = element_text(size=14),
legend.title = element_text(size=14)) +
guides(colour = guide_legend(override.aes = list(linewidth = 0.8, size = 2))) +
labs(
color = "",
x = "",
y = "Predicted Probability"
) +
ylim(0,0.9) +
xlim(1979,2021)
results_detailed %>%
mutate(prob_PM = prob_P + prob_M) %>%
mutate(
edu_attain_3cat = factor(
edu_attain_3cat,
levels = c(0, 1, 2),
labels = c("less than BA/BS", "BA/BS", "graduate")
)
) %>%
pivot_longer(
cols = starts_with("prob_"),     # prob_P, prob_M, prob_O
names_to = "category",
values_to = "prob"
) %>%
filter(category!="prob_O") %>%
mutate(category = factor(category,
levels = c("prob_PM", "prob_P", "prob_M"))) %>%
ggplot(aes(x = year, y = prob)) +
geom_line(aes(color = edu_attain_3cat)) +
geom_point(aes(color = edu_attain_3cat)) +
geom_text_repel(
aes(label = sprintf("%.3f", prob), color = edu_attain_3cat),
size = 3,
show.legend = FALSE,
max.overlaps = Inf
) +
theme_bw() +
facet_grid(~category, labeller = labeller(category = c("prob_PM" = "PM combined",
"prob_P" = "professional",
"prob_M" = "managerial"))) +
scale_color_manual(
name = "",
labels = c("less than BA/BS", "BA/BS", "graduate"),
values = c("less than BA/BS" = "blue",
"BA/BS"  = "green3",
"graduate" = "red")
) +
theme(text = element_text(family="Times"),
legend.position="bottom",
plot.title = element_text(size=11),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_blank(),
strip.text.x = element_text(size = 14, colour = "black", face="bold"),
panel.border = element_rect(colour = "black", fill = NA, linewidth=0.6),
axis.text.y = element_text(size=10, angle=90, hjust=0.5),
axis.text.x = element_text(size=10),
axis.title.x = element_blank(),
axis.title=element_text(size=14,hjust=0.5),
legend.text = element_text(size=14),
legend.title = element_text(size=14)) +
guides(colour = guide_legend(override.aes = list(linewidth = 0.8, size = 2))) +
labs(
color = "",
x = "",
y = "Predicted Probability"
) +
ylim(0,0.9) +
xlim(1979,2021)
head(df_multi)
## run multinomial every year
results_detailed <- data.frame()
library(nnet)
df_multi <- df %>% mutate(P_M_egp = case_when(
occ2010 >= 10 & occ2010 <= 430 & is_PM_egp == 2 ~ 1, ## management
(occ2010 > 430 & is_PM_egp == 2) ~ 2,      ## professional
.default = 0                                  ## non-PM
))
for (year in c(1980,1990,2000,2010,2019)) {
## subset once for this year
dsub <- df_multi[df_multi$year==year,]
## specify model and predict (use weights=)
model <- multinom(
P_M_egp ~ factor(edu_attain_3cat) + factor(lmexp) + factor(race) +
factor(public) + factor(ind1990_agg),
data = dsub,
weights = weight
)
## get predicted probs for the same rows in dsub
preds <- predict(model, newdata = dsub, type = "probs")
## summarize (columns will be named "0","1","2" if your factor is coded that way)
result <- dsub %>%
bind_cols(as.data.frame(preds)) %>%
group_by(edu_attain_3cat) %>%
summarize(
prob_P = weighted.mean(`2`, weight),
prob_M = weighted.mean(`1`, weight),
prob_O = weighted.mean(`0`, weight),
.groups = "drop"
) %>%
mutate(year=year)
results_detailed <- rbind(results_detailed, result)
}
## plot the results
library(ggrepel)
results_detailed %>%
remove_labels() %>%
mutate(prob_PM = prob_P + prob_M) %>%
mutate(
edu_attain_3cat = factor(
edu_attain_3cat,
levels = c(0, 1, 2),
labels = c("less than BA/BS", "BA/BS", "graduate")
)
) %>%
pivot_longer(
cols = starts_with("prob_"),     # prob_P, prob_M, prob_O
names_to = "category",
values_to = "prob"
) %>%
filter(category!="prob_O") %>%
mutate(category = factor(category,
levels = c("prob_PM", "prob_P", "prob_M"))) %>%
ggplot(aes(x = year, y = prob)) +
geom_line(aes(color = edu_attain_3cat)) +
geom_point(aes(color = edu_attain_3cat)) +
geom_text_repel(
aes(label = sprintf("%.3f", prob), color = edu_attain_3cat),
size = 3,
show.legend = FALSE,
max.overlaps = Inf
) +
theme_bw() +
facet_grid(~category, labeller = labeller(category = c("prob_PM" = "PM combined",
"prob_P" = "professional",
"prob_M" = "managerial"))) +
scale_color_manual(
name = "",
labels = c("less than BA/BS", "BA/BS", "graduate"),
values = c("less than BA/BS" = "blue",
"BA/BS"  = "green3",
"graduate" = "red")
) +
theme(text = element_text(family="Times"),
legend.position="bottom",
plot.title = element_text(size=11),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_blank(),
strip.text.x = element_text(size = 14, colour = "black", face="bold"),
panel.border = element_rect(colour = "black", fill = NA, linewidth=0.6),
axis.text.y = element_text(size=10, angle=90, hjust=0.5),
axis.text.x = element_text(size=10),
axis.title.x = element_blank(),
axis.title=element_text(size=14,hjust=0.5),
legend.text = element_text(size=14),
legend.title = element_text(size=14)) +
guides(colour = guide_legend(override.aes = list(linewidth = 0.8, size = 2))) +
labs(
color = "",
x = "",
y = "Predicted Probability"
) +
ylim(0,0.9) +
xlim(1979,2021)
results_detailed %>%
mutate(prob_PM = prob_P + prob_M) %>%
mutate(
edu_attain_3cat = factor(
edu_attain_3cat,
levels = c(0, 1, 2),
labels = c("less than BA/BS", "BA/BS", "graduate")
)
) %>%
pivot_longer(
cols = starts_with("prob_"),     # prob_P, prob_M, prob_O
names_to = "category",
values_to = "prob"
) %>%
filter(category!="prob_O") %>%
mutate(category = factor(category,
levels = c("prob_PM", "prob_P", "prob_M"))) %>%
ggplot(aes(x = year, y = prob)) +
geom_line(aes(color = edu_attain_3cat)) +
geom_point(aes(color = edu_attain_3cat)) +
geom_text_repel(
aes(label = sprintf("%.3f", prob), color = edu_attain_3cat),
size = 3,
show.legend = FALSE,
max.overlaps = Inf
) +
theme_bw() +
facet_grid(~category, labeller = labeller(category = c("prob_PM" = "PM combined",
"prob_P" = "professional",
"prob_M" = "managerial"))) +
scale_color_manual(
name = "",
labels = c("less than BA/BS", "BA/BS", "graduate"),
values = c("less than BA/BS" = "blue",
"BA/BS"  = "green3",
"graduate" = "red")
) +
theme(text = element_text(family="Times"),
legend.position="bottom",
plot.title = element_text(size=11),
panel.grid.minor.x = element_blank(),
panel.grid.major.x = element_blank(),
axis.line = element_blank(),
strip.text.x = element_text(size = 14, colour = "black", face="bold"),
panel.border = element_rect(colour = "black", fill = NA, linewidth=0.6),
axis.text.y = element_text(size=10, angle=90, hjust=0.5),
axis.text.x = element_text(size=10),
axis.title.x = element_blank(),
axis.title=element_text(size=14,hjust=0.5),
legend.text = element_text(size=14),
legend.title = element_text(size=14)) +
guides(colour = guide_legend(override.aes = list(linewidth = 0.8, size = 2))) +
labs(
color = "",
x = "",
y = "Predicted Probability"
) +
ylim(0,0.9) +
xlim(1979,2021)
###### TWFE using percent graduate on wages ######
## group by occ2010 and calculate percent graduate and returns to graduate
results <- data.frame()
for (y in c(1980,1990,2000,2010,2019)){
## select occupations in PM and with two or more education categories
occ <-
df %>% filter(is_PM_egp==2) %>%
filter(year==y) %>%
group_by(occ2010) %>%
dplyr::summarize(n=length(unique(edu_attain_3cat)),
size=sum(weight)) %>%
filter(n>=2) %>%
mutate(year=y) %>%
select(-n)
## calculate percent graduate, percent BA, wages, race
## public, female, and industry
mean_var <-
df %>%
filter(year==y) %>%
filter(is_PM_egp==2&occ2010%in%occ$occ2010) %>%
group_by(occ2010) %>%
dplyr::summarize(pgrad = sum(weight[edu_attain_3cat==2])/sum(weight),
pBA = sum(weight[edu_attain_3cat==1])/sum(weight),
wage = weighted.mean(income_pce_cap_ln,w=weight),
lmexp_1 = weighted.mean(lmexp==0,w=weight),
lmexp_2 = weighted.mean(lmexp==1,w=weight),
lmexp_3 = weighted.mean(lmexp==2,w=weight),
lmexp_4 = weighted.mean(lmexp==3,w=weight),
race_1 = sum(weight[race==1])/sum(weight),
race_2 = sum(weight[race==2])/sum(weight),
race_3 = sum(weight[race==3])/sum(weight),
race_4 = sum(weight[race==4])/sum(weight),
race_5 = sum(weight[race==5])/sum(weight),
public_1 = sum(weight[public==1])/sum(weight),
female_1 = sum(weight[female==1])/sum(weight),
ind1990_1 = sum(weight[ind1990_agg==1])/sum(weight),
ind1990_2 = sum(weight[ind1990_agg==2])/sum(weight),
ind1990_3 = sum(weight[ind1990_agg==3])/sum(weight),
ind1990_4 = sum(weight[ind1990_agg==4])/sum(weight),
ind1990_5 = sum(weight[ind1990_agg==5])/sum(weight),
ind1990_6 = sum(weight[ind1990_agg==6])/sum(weight),
ind1990_7 = sum(weight[ind1990_agg==7])/sum(weight),
ind1990_8 = sum(weight[ind1990_agg==8])/sum(weight),
ind1990_9 = sum(weight[ind1990_agg==9])/sum(weight),
ind1990_10 = sum(weight[ind1990_agg==10])/sum(weight),
ind1990_11 = sum(weight[ind1990_agg==11])/sum(weight),
ind1990_12 = sum(weight[ind1990_agg==12])/sum(weight))
mean_var <- merge(mean_var, occ, by="occ2010", all.x=T)
## save results
results <- rbind(results,mean_var)
}
library(lfe)
model1 <- felm(wage ~ pgrad + pBA +
lmexp_2 + lmexp_3 + lmexp_4 +
race_1 + race_2 + race_3 + race_4 + race_5 +
public_1 + female_1 +
ind1990_1 + ind1990_2 + ind1990_3 + ind1990_4 + ind1990_5 +
ind1990_6 + ind1990_7 + ind1990_8 + ind1990_9 + ind1990_10 +
ind1990_11 + ind1990_12
| occ2010 + year | 0 | occ2010,
data = results,
weight = results$weight)
model2 <- felm(wage ~ pgrad + pBA +
lmexp_2 + lmexp_3 + lmexp_4 +
race_1 + race_2 + race_3 + race_4 + race_5 +
public_1 + female_1 +
ind1990_1 + ind1990_2 + ind1990_3 + ind1990_4 + ind1990_5 +
ind1990_6 + ind1990_7 + ind1990_8 + ind1990_9 + ind1990_10 +
ind1990_11 + ind1990_12
| 0 | 0 | occ2010,
data = results,
weight = results$weight)
model3 <- felm(wage ~ pgrad + pBA +
lmexp_2 + lmexp_3 + lmexp_4 +
race_1 + race_2 + race_3 + race_4 + race_5 +
public_1 + female_1 +
ind1990_1 + ind1990_2 + ind1990_3 + ind1990_4 + ind1990_5 +
ind1990_6 + ind1990_7 + ind1990_8 + ind1990_9 + ind1990_10 +
ind1990_11 + ind1990_12
| occ2010 | 0 | occ2010,
data = results,
weight = results$weight)
model4 <- felm(wage ~ pgrad + pBA +
lmexp_2 + lmexp_3 + lmexp_4 +
race_1 + race_2 + race_3 + race_4 + race_5 +
public_1 + female_1 +
ind1990_1 + ind1990_2 + ind1990_3 + ind1990_4 + ind1990_5 +
ind1990_6 + ind1990_7 + ind1990_8 + ind1990_9 + ind1990_10 +
ind1990_11 + ind1990_12
| year | 0 | occ2010,
data = results,
weight = results$weight)
library(stargazer)
stargazer(model2, model3, model4, model1,
type="text",
star.cutoffs = c(0.05, 0.01, 0.001),
out="/Users/wenhao/Library/CloudStorage/Dropbox/RA Paula/New SF R&R/model1.htm")
